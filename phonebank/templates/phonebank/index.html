{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="referrer" content="same-origin">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Phonebank</title>
    <link rel="icon" href="{% static 'boran.png' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha256-+IZRbz1B6ee9mUx/ejmonK+ulIP5A5bLDd6v6NHqXnI=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
    <style>
      body {
        padding-top: 5rem;
      }
      .alert, .btn-primary, .btn-secondary, .card {
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
      <a class="navbar-brand" href="">Phonebank</a>
      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
          {% for nav_link in nav_links %}
          <li class="nav-item">
            <a class="nav-link" href="{{ nav_link.url }}" rel="noreferrer" target="_blank">{{ nav_link.name }}</a>
          </li>
          {% endfor %}
        </ul>
      <a href="https://en.wikipedia.org/wiki/Boran" rel="noreferrer" target="_blank"><img class="pull-right" src="{% static 'boran.png' %}" height="25px"/></a>
      </div>
    </nav>

    <main role="main" class="container-fluid">
      <div class="alerts"></div>
      <div class="row">
          <div class="col" id="formContainer">
            <iframe id="form" src="{{ google_form_url }}?usp=pp_url&embedded=true" width="100%" frameborder="0" marginheight="0" marginwidth="0" referrerpolicy="no-referrer">Loadingâ€¦</iframe>
          </div>
          <div class="col-xl-3 col-lg-4 col-md-5">
            <div class="card">
              <h5 class="card-header"><span id="name"></span><span class="pull-right"><small class="text-muted"><span id="id"></span> <span id="statename"></span></small></span></h5>
              <div class="card-body">
                <div class="small" id="notes" style="font-family: monospace">
                </div>
                <div id="phones">
                  <div class="alert alert-primary" role="alert">
                    Before continuing, please place an echo test call to verify that your headphones and microphone are working correctly. You should be able to hear yourself speak once the call is active.
                  </div>
                </div>
                <div id="similar_voters">
                </div>
                <span class="pull-right">
                  <!-- Another echo test SIP URI address is sip:echo@iptel.org -->
                  <button type="button" class="btn btn-secondary" onclick="connectAndCall('sip:4444@sip2sip.info')" id="echo" disabled="true">Echo test
                    <i class="fa fa-phone" aria-hidden="true"></i>
                  </button>
                  <button type="button" class="btn btn-primary" onclick="getContact()" id="getContact" disabled="true">New contact
                    <i class="fa fa-user-plus" aria-hidden="true"></i>
                  </button>
                </span>
              </div>
            </div>
            <div class="card d-none" id="callInfo">
              <h5 class="card-header">
                <span id="callStatus"></span>
                <small class="text-muted" id="agentStats"></small>
                <button type="button" class="btn btn-danger pull-right d-none" onclick="currentCall.hangup()" id="hangupCall" disabled="true">Hangup
                  <i class="fa fa-close" aria-hidden="true"></i>
                </button>
              </h5>
              <div class="card-body">
                <div class="alert alert-secondary d-none" role="alert" id="callLogContainer">
                  <code id="callLog"></code>
                </div>
                <audio id="audioCall" autoPlay="autoplay"/>
              </div>
            </div>
          </div>
          <div class="col-xl-5 col-lg-4" id="meet">
          </div>
      </div>
    </main>

    <script
      src="https://browser.sentry-cdn.com/7.41.0/bundle.min.js"
      integrity="sha384-G2xNjblHi6NB8kRkcvFx2kqUMFeyS+OY+8SdfIqooyjTGC52RhRwhvMVcul/Adpv"
      crossorigin="anonymous"
    ></script>
    <script>
      if (window.navigator.userAgent.indexOf('Chrome') === -1 && window.navigator.userAgent.indexOf('Firefox') === -1) {
        alert("It looks like you're using a browser we don't support. Please try again with the latest version of Brave or Chrome.");
      }
      Sentry.init({dsn: '{{ sentry_dsn }}'});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha256-/ijcOLwFf26xEYAjW75FizKVo5tnTYiQddPZoLUHHZ8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha256-QjIXq/h3XOotww+h/j4cXiTcNZqA8cN60pqGCUv+gdE=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/libphonenumber-js@1.10.21/bundle/libphonenumber-js.min.js" integrity="sha256-m2S+cXlam/mJ+FFygyuk3ac1DVPCIzEeFfv0BoP5gtA=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/webrtc-adapter@8.2.1/out/adapter.js" integrity="sha256-tn/6nj2kh5eF1JIZ7VvROoCmrJd+K7Qm8JaT4HH3sLY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@telnyx/webrtc@2.9.0/lib/bundle.js" integrity="sha256-eztEU4iNdVeJds6ZY8b4xyYL7CudNMidKmbOowCKbYg=" crossorigin="anonymous"></script>
    <script src="https://{{ jitsi_server }}/external_api.js"></script>
    <script>
      const agentName = '{{ agent_name }}';
      const googleFormUrl = '{{ google_form_url }}';
      const jitsiRoom = '{{ jitsi_room }}';
      const jitsiServer = '{{ jitsi_server }}';
    </script>
    <script src="{% static 'phonebank/phonebank.js' %}"></script>
  </body>
</html>
